fn main() {
}

#[cfg(test)]
mod tests {
    use std::fs::File;
    use ethabi::{ParamType, Uint, Token};
    use hex_literal::hex;

    #[test]
    fn test_simple_decode() {
        let data = "0x5eac623900000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001ae81747fd2d50ae0c7c07716c8b2f873a1c5e10471b077ec6e5fbcd23467e12e";
        // println!("{}", &data[2..]);

        let data = hex::decode(&data[10..]);
        let data = data.unwrap();

        let result = ethabi::decode(&[
            ParamType::Array(Box::from(ParamType::Uint(256)))
        ], &data).unwrap();

        let result = result[0].clone().into_array().unwrap()[0].clone().into_uint().unwrap();
        // println!("{:?}", result);
        let expected = Uint::from(&hex::decode("ae81747fd2d50ae0c7c07716c8b2f873a1c5e10471b077ec6e5fbcd23467e12e").unwrap()[..]);
        // println!("{:?}", expected);

        assert_eq!(result, expected);
    }

    #[test]
    fn test_simple_decode_contract() {
        let file = File::open("./abi/Simple.json").unwrap();
        let contract = ethabi::Contract::load(file).unwrap();
        let functions = contract.functions_by_name("claimRewards").unwrap();

        assert_eq!(functions.len(), 1);

        let function = functions[0].clone();

        let input = hex!("00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001ae81747fd2d50ae0c7c07716c8b2f873a1c5e10471b077ec6e5fbcd23467e12e");

        let result = function.decode_input(&input).unwrap();
        let result = result[0].clone().into_array().unwrap()[0].clone().into_uint().unwrap();
        // println!("{:?}", result);

        let expected = Uint::from(&hex::decode("ae81747fd2d50ae0c7c07716c8b2f873a1c5e10471b077ec6e5fbcd23467e12e").unwrap()[..]);
        // println!("{:?}", expected);

        assert_eq!(result, expected);
    }

    #[test]
    fn test_simple_encode_contract() {
        let file = File::open("./abi/Simple.json").unwrap();
        let contract = ethabi::Contract::load(file).unwrap();
        let functions = contract.functions_by_name("claimRewards").unwrap();

        assert_eq!(functions.len(), 1);

        let function = functions[0].clone();

        let id_0 = hex!("84c9bedcbb3d7eb2822ec2177fe8975668e0d24ee97c1886b7af99afdad13d29");
        let id_0 = Token::Uint(Uint::from(&id_0[..]));
        let id_1 = hex!("7540d9a06df1100608d88c7beed7f8bc0c5c29ed4a68b0f895fae2ff7fc908b0");
        let id_1 = Token::Uint(Uint::from(&id_1[..]));
        let result = function.encode_input(&[Token::Array(vec![id_0, id_1])]).unwrap();
        let result = hex::encode(result);
        // println!("{:?}", result);

        assert_eq!(result, "5eac62390000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000284c9bedcbb3d7eb2822ec2177fe8975668e0d24ee97c1886b7af99afdad13d297540d9a06df1100608d88c7beed7f8bc0c5c29ed4a68b0f895fae2ff7fc908b0")
    }

    #[test]
    fn test_constructor_decode_contract() {
        let file = File::open("./abi/TreasureFarm.json").unwrap();
        let contract = ethabi::Contract::load(file).unwrap();

        let constructor =  contract.constructor.unwrap();
        // println!("{:?}", constructor);
        let types: Vec<ParamType> = constructor.inputs.iter().map(|p| p.kind.clone()).collect();
        // println!("{:?}", types);

        let input = hex!("000000000000000000000000b0c7a3ba49c7a6eaba6cd4a96c55a1391070ac9a000000000000000000000000d0ed73b33789111807bd64ae2a6e1e6f92f986f5000000000000000000000000000000000000000000000000000000000002bf200000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000002f00000000000000000000000000000000000000000000000000000000000005e0000000000000000000000000000000000000000000000000000000000000066000000000000000000000000000000000000000000000000000000000000006e0000000000000000000000000000000000000000000000000000000000000076000000000000000000000000000000000000000000000000000000000000007e0000000000000000000000000000000000000000000000000000000000000086000000000000000000000000000000000000000000000000000000000000008e0000000000000000000000000000000000000000000000000000000000000096000000000000000000000000000000000000000000000000000000000000009e00000000000000000000000000000000000000000000000000000000000000a600000000000000000000000000000000000000000000000000000000000000ae00000000000000000000000000000000000000000000000000000000000000b600000000000000000000000000000000000000000000000000000000000000be00000000000000000000000000000000000000000000000000000000000000c600000000000000000000000000000000000000000000000000000000000000ce00000000000000000000000000000000000000000000000000000000000000d600000000000000000000000000000000000000000000000000000000000000de00000000000000000000000000000000000000000000000000000000000000e600000000000000000000000000000000000000000000000000000000000000ee00000000000000000000000000000000000000000000000000000000000000f600000000000000000000000000000000000000000000000000000000000000fe0000000000000000000000000000000000000000000000000000000000000106000000000000000000000000000000000000000000000000000000000000010e0000000000000000000000000000000000000000000000000000000000000116000000000000000000000000000000000000000000000000000000000000011e0000000000000000000000000000000000000000000000000000000000000126000000000000000000000000000000000000000000000000000000000000012e0000000000000000000000000000000000000000000000000000000000000136000000000000000000000000000000000000000000000000000000000000013e0000000000000000000000000000000000000000000000000000000000000146000000000000000000000000000000000000000000000000000000000000014e0000000000000000000000000000000000000000000000000000000000000156000000000000000000000000000000000000000000000000000000000000015e0000000000000000000000000000000000000000000000000000000000000166000000000000000000000000000000000000000000000000000000000000016e0000000000000000000000000000000000000000000000000000000000000176000000000000000000000000000000000000000000000000000000000000017e0000000000000000000000000000000000000000000000000000000000000186000000000000000000000000000000000000000000000000000000000000018e0000000000000000000000000000000000000000000000000000000000000196000000000000000000000000000000000000000000000000000000000000019e00000000000000000000000000000000000000000000000000000000000001a600000000000000000000000000000000000000000000000000000000000001ae00000000000000000000000000000000000000000000000000000000000001b600000000000000000000000000000000000000000000000000000000000001be00000000000000000000000000000000000000000000000000000000000001c600000000000000000000000000000000000000000000000000000000000001ce000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000005ebd312a02aa4000000000000000000000000000000000000000000000000000000000000000b426565746c652d77696e6700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000005ebd312a02aa400000000000000000000000000000000000000000000000000000000000000074469616d6f6e640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000005ebd312a02aa4000000000000000000000000000000000000000000000000000000000000000b447261676f6e205461696c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000005ebd312a02aa40000000000000000000000000000000000000000000000000000000000000007456d6572616c640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000005ebd312a02aa40000000000000000000000000000000000000000000000000000000000000009476f6c6420436f696e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000005ebd312a02aa4000000000000000000000000000000000000000000000000000000000000000a48616c662d50656e6e790000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000005ebd312a02aa40000000000000000000000000000000000000000000000000000000000000005506561726c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000005ebd312a02aa4000000000000000000000000000000000000000000000000000000000000000d517561727465722d50656e6e790000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000005ebd312a02aa40000000000000000000000000000000000000000000000000000000000000009526564205275706565000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000005ebd312a02aa4000000000000000000000000000000000000000000000000000000000000000c53696c7665722050656e6e79000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000005ebd312a02aa40000000000000000000000000000000000000000000000000000000000000006446f6e6b657900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000001d9b1f5d20d534000000000000000000000000000000000000000000000000000000000000000a426c75652052757065650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000005ebd312a02aa400000000000000000000000000000000000000000000000000000000000000024f780000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000002c68af0bb13fce000000000000000000000000000000000000000000000000000000000000000c436f6d6d6f6e2052656c6963000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000005ebd312a02aa4000000000000000000000000000000000000000000000000000000000000000e436f6d6d6f6e20466561746865720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000001d9b1f5d20d5340000000000000000000000000000000000000000000000000000000000000005477261696e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000002c68af0bb13fce000000000000000000000000000000000000000000000000000000000000000b477265656e2052757065650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000001d9b1f5d20d53400000000000000000000000000000000000000000000000000000000000000064c756d62657200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000003b363eba41aa68000000000000000000000000000000000000000000000000000000000000000d416e6369656e742052656c6963000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000003b363eba41aa680000000000000000000000000000000000000000000000000000000000000015426167206f662052617265204d757368726f6f6d7300000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000003b363eba41aa6800000000000000000000000000000000000000000000000000000000000000114261697420666f72204d6f6e73746572730000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000003b363eba41aa680000000000000000000000000000000000000000000000000000000000000011426f74746f6d6c65737320456c697869720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000003b363eba41aa680000000000000000000000000000000000000000000000000000000000000013436170206f6620496e7669736962696c697479000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000002c68af0bb13fce00000000000000000000000000000000000000000000000000000000000000084361727269616765000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000766c7d748354d00000000000000000000000000000000000000000000000000000000000000006436173746c65000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000005ebd312a02aa4000000000000000000000000000000000000000000000000000000000000000b436f6d6d6f6e20426561640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000001d9b1f5d20d5340000000000000000000000000000000000000000000000000000000000000003436f770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000b1a2bc2ec4ff380000000000000000000000000000000000000000000000000000000000000010446976696e6520486f7572676c61737300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000b1a2bc2ec4ff38000000000000000000000000000000000000000000000000000000000000000b446976696e65204d61736b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000766c7d748354d000000000000000000000000000000000000000000000000000000000000000134661766f722066726f6d2074686520476f6473000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000003b363eba41aa6800000000000000000000000000000000000000000000000000000000000000104672616d656420427574746572666c7900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000766c7d748354d000000000000000000000000000000000000000000000000000000000000000044772696e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000003b363eba41aa680000000000000000000000000000000000000000000000000000000000000009486f6e6579636f6d62000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000058d15e17627f9c000000000000000000000000000000000000000000000000000000000000000f496d6d6f7661626c652053746f6e6500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000003b363eba41aa68000000000000000000000000000000000000000000000000000000000000000f49766f72792042726561737470696e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000766c7d748354d0000000000000000000000000000000000000000000000000000000000000000e4a6172206f6620466169726965730000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000001d9b1f5d20d53400000000000000000000000000000000000000000000000000000000000000104d696c69746172792053746970656e640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000058d15e17627f9c000000000000000000000000000000000000000000000000000000000000000d4d6f6c6c75736b205368656c6c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000679eedc5f2ea36000000000000000000000000000000000000000000000000000000000000000b506f74206f6620476f6c64000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000679eedc5f2ea36000000000000000000000000000000000000000000000000000000000000000e53636f7265206f662049766f727900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000005ebd312a02aa4000000000000000000000000000000000000000000000000000000000000000a536d616c6c20426972640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000008e1bc9bf03ff6000000000000000000000000000000000000000000000000000000000000000b52656420466561746865720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000002f5e98950155200000000000000000000000000000000000000000000000000000000000000012536e6f772057686974652046656174686572000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000058d15e17627f9c000000000000000000000000000000000000000000000000000000000000001552656420616e6420576869746520466561746865720000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000766c7d748354d00000000000000000000000000000000000000000000000000000000000000015546872656164206f6620446976696e652053696c6b0000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000679eedc5f2ea360000000000000000000000000000000000000000000000000000000000000017556e627265616b61626c6520506f636b65747761746368000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000679eedc5f2ea36000000000000000000000000000000000000000000000000000000000000000d576974636865732042726f6f6d00000000000000000000000000000000000000");
        let result = ethabi::decode(&types, &input);
        // println!("{:?}", result);
    }
}
